
-------------TB_USER_WISH DDL(jiwoong)-------------

/* 찜 TABLE */
CREATE TABLE TB_USER_WISH (
	USR_ID VARCHAR2(64) NOT NULL, /* 사용자 아이디 */
	PRDT_NO NUMBER NOT NULL, /* 상품 번호 */
	CRT_DT DATE /* 생성 일시 */
);

CREATE UNIQUE INDEX PK_TB_USER_WISH
	ON TB_USER_WISH (
		USR_ID ASC,
		PRDT_NO ASC
	);

ALTER TABLE TB_USER_WISH
	ADD
		CONSTRAINT PK_TB_USER_WISH
		PRIMARY KEY (
			USR_ID,
			PRDT_NO
		);

COMMENT ON TABLE TB_USER_WISH IS '사용자 관심 상품 목록';

COMMENT ON COLUMN TB_USER_WISH.USR_ID IS '사용자 아이디';

COMMENT ON COLUMN TB_USER_WISH.PRDT_NO IS '상품 번호';

COMMENT ON COLUMN TB_USER_WISH.CRT_DT IS '생성 일시';

ALTER TABLE TB_USER_WISH
	ADD
		CONSTRAINT FK_TB_USER_TO_TB_USER_WISH
		FOREIGN KEY (
			USR_ID
		)
		REFERENCES TB_USER (
			USR_ID
		);

ALTER TABLE TB_USER_WISH
	ADD
		CONSTRAINT FK_TB_PRODUCT_TO_TB_USER_WISH
		FOREIGN KEY (
			PRDT_NO
		)
		REFERENCES  (
			PRDT_NO
		);


-------------------- TB_PRODUCT_CATEGORY, TB_PRODUCT_BIGCATEGORY DDL(창훈) -----------

-- 상품 카테고리
CREATE TABLE TB_PRODUCT_CATEGORY (
	CATECODE    NUMBER        NOT NULL, -- 카테고리 번호
	CATENAME    VARCHAR2(64) NULL,     -- 카테고리 내용
	CATECODEREF NUMBER        NULL      -- 카테고리 참조번호
);

-- 상품 카테고리 기본키
CREATE UNIQUE INDEX PK_TB_PRODUCT_CATEGORY
	ON TB_PRODUCT_CATEGORY (
		CATECODE ASC
	);

-- 상품 카테고리
ALTER TABLE TB_PRODUCT_CATEGORY
	ADD
		CONSTRAINT PK_TB_PRODUCT_CATEGORY
		PRIMARY KEY (
			CATECODE
		);

-- 상품 카테고리
COMMENT ON TABLE TB_PRODUCT_CATEGORY IS '상품 카테고리';

-- 카테고리 번호
COMMENT ON COLUMN TB_PRODUCT_CATEGORY.CATECODE IS '카테고리 번호';

-- 카테고리 내용
COMMENT ON COLUMN TB_PRODUCT_CATEGORY.CATENAME IS '카테고리 내용';

-- 카테고리 참조번호
COMMENT ON COLUMN TB_PRODUCT_CATEGORY.CATECODEREF IS '카테고리 참조번호';

-- 상품 카테고리 기본키
COMMENT ON INDEX PK_TB_PRODUCT_CATEGORY IS '상품 카테고리 기본키';

-- 상품 카테고리 기본키
COMMENT ON CONSTRAINT TB_PRODUCT_CATEGORY.PK_TB_PRODUCT_CATEGORY IS '상품 카테고리 기본키';

--  카테고리 대분류
CREATE TABLE TB_PRODUCT_BIGCATEGORY (
	CATECODEREF NUMBER        NOT NULL, -- 카테고리 참조번호
	CATENAME    VARCHAR2(64) NULL      -- 카테고리 내용
);

--  카테고리 대분류 기본키
CREATE UNIQUE INDEX PK_TB_PRODUCT_BIGCATEGORY
	ON TB_PRODUCT_BIGCATEGORY (
		CATECODEREF ASC
	);

--  카테고리 대분류
ALTER TABLE TB_PRODUCT_BIGCATEGORY
	ADD
		CONSTRAINT PK_TB_PRODUCT_BIGCATEGORY
		PRIMARY KEY (
			CATECODEREF
		);

--  카테고리 대분류
COMMENT ON TABLE TB_PRODUCT_BIGCATEGORY IS ' 카테고리 대분류';

-- 카테고리 참조번호
COMMENT ON COLUMN TB_PRODUCT_BIGCATEGORY.CATECODEREF IS '카테고리 참조번호';

-- 카테고리 내용
COMMENT ON COLUMN TB_PRODUCT_BIGCATEGORY.CATENAME IS '카테고리 내용';

--  카테고리 대분류 기본키
COMMENT ON INDEX PK_TB_PRODUCT_BIGCATEGORY IS ' 카테고리 대분류 기본키';

--  카테고리 대분류 기본키
COMMENT ON CONSTRAINT TB_PRODUCT_BIGCATEGORY.PK_TB_PRODUCT_BIGCATEGORY IS ' 카테고리 대분류 기본키';


-- 상품 카테고리
ALTER TABLE TB_PRODUCT_CATEGORY
	ADD
		CONSTRAINT FK_TB_PRODUCT_BIGCATEGORY
		FOREIGN KEY (
			CATECODEREF
		)
		REFERENCES TB_PRODUCT_BIGCATEGORY (
			CATECODEREF
		);

--  카테고리 대분류 -> 상품 카테고리
COMMENT ON CONSTRAINT TB_PRODUCT_CATEGORY.FK_TB_PRODUCT_BIGCATEGORY_TO_TB_PRODUCT_CATEGORY IS ' 카테고리 대분류 -> 상품 카테고리';


------------------------------- TB_PRODUCT COLUMN 추가 (창훈) -----------------
ALTER TABLE TB_PRODUCT ADD CATECODE NUMBER;

ALTER TABLE TB_PRODUCT
	ADD
		CONSTRAINT FK_TB_PRODUCT_CATEGORY
		FOREIGN KEY (
			CATECODE
		)
		REFERENCES TB_PRODUCT_CATEGORY (
			CATECODE
		);


------------------------------ 상품 이미지 처리 (지현) ----------------------------
CREATE SEQUENCE SQ_PRDT_IMG_NO;

-- 함수 생성
create or replace FUNCTION  GET_PRODUCT_IMAGE
( p_PRDT_NO          IN      TB_PRODUCT_IMAGE.PRDT_NO%TYPE ,
  p_PRDT_IMG_NO      IN      TB_PRODUCT_IMAGE.PRDT_IMG_NO%TYPE
)

-- 1) Parameter : 상품번호
RETURN             varchar2
IS
   v_IMG_URL            TB_PRODUCT_IMAGE.IMG_URL%TYPE;
 BEGIN

-- 2) 상품번호와 이미지번호로 이미지URL
   SELECT          IMG_URL
   INTO            v_IMG_URL
   FROM           TB_PRODUCT_IMAGE
   WHERE         PRDT_NO = p_PRDT_NO
   AND           PRDT_IMG_NO = p_PRDT_IMG_NO;

-- 3)이미지 전달
   RETURN(v_IMG_URL);
END GET_PRODUCT_IMAGE;